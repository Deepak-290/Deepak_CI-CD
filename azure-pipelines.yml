# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
trigger: none

pool:
  name: My_Local_Agent

steps:
- checkout: self
  clean: true

# 1Ô∏è‚É£ Install VS Test Platform
- task: VisualStudioTestPlatformInstaller@1
  displayName: Install Visual Studio Test Platform
  inputs:
    packageFeedSelector: nugetOrg
    versionSelector: latestStable

# 2Ô∏è‚É£ Install TestComplete Adapter (FORCED)
- task: InstallTestCompleteAdapter@1
  displayName: Install TestComplete Adapter
  condition: succeededOrFailed()
  inputs:
    logsLevel: '0'

# 3Ô∏è‚É£ Run TestComplete project (FORCED + CORRECT)
- task: VSTest@3
  displayName: Run TestComplete Project-1
  condition: succeededOrFailed()
  inputs:
    testSelector: testAssemblies
    testAssemblyVer2: '**\Project-1.pjs'
    searchFolder: '$(Build.SourcesDirectory)'
    pathtoCustomTestAdapters: '$(Agent.TempDirectory)\TestCompleteAdapter'
    vsTestVersion: toolsInstaller   # üîë CRITICAL
    diagnosticsEnabled: true
    failOnMinTestsNotRun: true

# 4Ô∏è‚É£ Publish results
- task: PublishTestResults@2
  displayName: Publish Test Results
  condition: succeededOrFailed()
  inputs:
    testResultsFormat: VSTest
    testResultsFiles: '**/*.trx'
    searchFolder: '$(Agent.TempDirectory)'
    mergeTestResults: true
    failTaskOnFailedTests: true
