# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
trigger: none

pool:
  name: My_Local_Agent   # <-- your self-hosted agent pool

steps:
# 1ï¸âƒ£ Install Visual Studio Test Platform (NO Visual Studio needed)
- task: VisualStudioTestPlatformInstaller@1
  displayName: Install Visual Studio Test Platform
  inputs:
    packageFeedSelector: nugetOrg
    versionSelector: latestStable

# 2ï¸âƒ£ Install TestComplete Adapter
- task: InstallTestCompleteAdapter@1
  displayName: Install TestComplete Adapter
  condition: succeededOrFailed()
  inputs:
    installExecutor: true
    updateExecutor: false
    searchMode: ExecutionPlan
    logsLevel: '0'

# 3ï¸âƒ£ Run TestComplete project from LOCAL PATH
- task: VSTest@3
  displayName: Run TestComplete Project-1
  condition: succeededOrFailed()
  inputs:
    testSelector: testAssemblies

    # ðŸ”´ LOCAL PROJECT PATH
    testAssemblyVer2: 'C:\Users\deepak.mangalagatti\Downloads\Project-1\Project-1.pjs'

    searchFolder: 'C:\Users\deepak.mangalagatti\Downloads\Project-1'

    vsTestVersion: toolsInstaller

    # ðŸ”´ EXPLICIT vstest.console location
    vstestLocationMethod: location
    vstestLocation: '$(Agent.TempDirectory)\VsTest\Microsoft.TestPlatform.*/tools/net462/Common7/IDE/Extensions/TestPlatform'

    diagnosticsEnabled: true
    failOnMinTestsNotRun: true

# 4ï¸âƒ£ Publish Test Results (.trx)
- task: PublishTestResults@2
  displayName: Publish Test Results
  condition: succeededOrFailed()
  inputs:
    testResultsFormat: VSTest
    testResultsFiles: '**/*.trx'
    searchFolder: '$(Agent.TempDirectory)'
    mergeTestResults: true
