# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
trigger: none

pool:
  name: My_Local_Agent

steps:
# 1️⃣ Checkout repo
- checkout: self
  clean: true

# 2️⃣ Install VS Test Platform (required for vstest)
- task: VisualStudioTestPlatformInstaller@1
  displayName: Install Visual Studio Test Platform
  inputs:
    packageFeedSelector: nugetOrg
    versionSelector: latestStable

# 3️⃣ Install TestComplete Adapter (FORCE RUN)
- task: InstallTestCompleteAdapter@1
  displayName: Install TestComplete Adapter
  condition: succeededOrFailed()
  inputs:
    logsLevel: '0'

# 4️⃣ Run TestComplete project using adapter
- task: VSTest@3
  displayName: Run TestComplete Project-1
  condition: succeededOrFailed()
  inputs:
    testSelector: testAssemblies
    testAssemblyVer2: '**\Project-1.pjs'
    searchFolder: '$(Build.SourcesDirectory)'
    pathtoCustomTestAdapters: '$(Agent.TempDirectory)\TestCompleteAdapter'
    diagnosticsEnabled: true

# 5️⃣ Publish test results to Azure DevOps
- task: PublishTestResults@2
  displayName: Publish Test Results
  condition: succeededOrFailed()
  inputs:
    testResultsFormat: VSTest
    testResultsFiles: '**/*.trx'
    searchFolder: '$(Agent.TempDirectory)'
    mergeTestResults: true
    failTaskOnFailedTests: true











