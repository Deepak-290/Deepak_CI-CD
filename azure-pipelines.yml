# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
trigger: none
pr: none

pool:
  name: My_Local_Agent

steps:

# 1Ô∏è‚É£ Install VS Test Platform
- task: VisualStudioTestPlatformInstaller@1
  displayName: 'Install Visual Studio Test Platform'
  condition: always()
  inputs:
    packageFeedSelector: 'nugetOrg'
    versionSelector: 'latestStable'

# 2Ô∏è‚É£ Install TestComplete Adapter
- task: InstallTestCompleteAdapter@1
  displayName: 'Install TestComplete Adapter'
  condition: always()
  inputs:
    searchMode: ExecutionPlan
    logsLevel: '0'

# 3Ô∏è‚É£ Run TestComplete project (FIXED)
- task: VSTest@3
  displayName: 'Run TestComplete Project-1'
  condition: always()
  inputs:
    testSelector: 'testAssemblies'

    # üî¥ MUST BE EXPLICIT FILE
    testAssemblyVer2: 'C:\Users\deepak.mangalagatti\Downloads\Project-1\Project-1.pjs'
    searchFolder: 'C:\Users\deepak.mangalagatti\Downloads\Project-1'

    # üî¥ REQUIRED FOR SELF-HOSTED AGENT
    vstestLocationMethod: 'toolsInstaller'
    vsTestVersion: 'toolsInstaller'

    diagnosticsEnabled: true
    runInParallel: false
    failOnMinTestsNotRun: false

# 4Ô∏è‚É£ Publish test results to Azure DevOps Test Runs
- task: PublishTestResults@2
  displayName: 'Publish Test Results'
  condition: always()
  inputs:
    testResultsFormat: 'VSTest'
    testResultsFiles: '**/*.trx'
    searchFolder: '$(Agent.TempDirectory)'
    mergeTestResults: true
