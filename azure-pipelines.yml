# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
trigger: none

pool:
  name: My_Local_Agent

stages:
- stage: QA
  displayName: Run TestComplete Tests
  jobs:
  - job: Run_TestComplete
    displayName: Execute TestComplete Project
    timeoutInMinutes: 120

    steps:
    # Always checkout repo
    - checkout: self
      clean: true

    # 1️⃣ Install Visual Studio Test Platform (REQUIRED)
    # Fixes: "No agent found which satisfies vstest"
    - task: VisualStudioTestPlatformInstaller@1
      displayName: Install Visual Studio Test Platform
      inputs:
        packageFeedSelector: nugetOrg
        versionSelector: latestStable

    # 2️⃣ Install TestComplete Azure DevOps Adapter
    - task: InstallTestCompleteAdapter@1
      displayName: Install TestComplete Adapter
      inputs:
        logsLevel: '0'

    # 3️⃣ Run TestComplete project using VSTest
    - task: VSTest@3
      displayName: Run TestComplete Project-1
      inputs:
        testSelector: testAssemblies
        testAssemblyVer2: '**\Project-1.pjs'
        searchFolder: '$(Build.SourcesDirectory)'
        pathtoCustomTestAdapters: '$(Agent.TempDirectory)\TestCompleteAdapter'
        diagnosticsEnabled: true
        failOnMinTestsNotRun: true

    # 4️⃣ Publish Test Results to Azure DevOps Test Runs
    - task: PublishTestResults@2
      displayName: Publish Test Results
      condition: succeededOrFailed()
      inputs:
        testResultsFormat: VSTest
        testResultsFiles: '**/*.trx'
        searchFolder: '$(Agent.TempDirectory)'
        mergeTestResults: true
        failTaskOnFailedTests: true











